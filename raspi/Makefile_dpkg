# Makefile for cross compiling of Ugglan for target
# (Raspberry Pi Zero) and creating a Debian package.
#

RASPI_ROOT = /$(shell pwd)/
RASPI_ROOT_MOUNTED = /raspi_mount

.DEFAULT_GOAL := build_dpkg

.PHONY: build_image build_dpkg build_dpkg_for_profiling

build_image:
	docker build -f Dockerfile_raspi . -t raspi

build_dpkg: build_image
	docker run -v $(RASPI_ROOT):${RASPI_ROOT_MOUNTED} \
	           -e ROOT_MOUNTED=${RASPI_ROOT_MOUNTED} \
			    raspi /raspi/build_dpkg.sh

build_dpkg_for_profiling: build_image
	docker run -v $(RASPI_ROOT):${RASPI_ROOT_MOUNTED} \
	           -e ROOT_MOUNTED=${RASPI_ROOT_MOUNTED} \
			    raspi /raspi/build_dpkg.sh -c -pg